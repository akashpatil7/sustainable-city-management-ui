<h1 class="title"> Real Time Dashboard </h1>

<p *ngIf="loadingData"> Loading... </p>

<div *ngIf="!loadingData" class="contentContainer">
  <div class="tableContainer">
    <!-- DUBLIN BIKES -->
    <p> Dublin Bikes </p>
    
    <div > Last Updated: {{lastUpdated | date: 'dd/MM/yyyy HH:mm'}} </div>
    <!-- Search bar -->
    <div role="main">
      <div>
        <div class="searchBar">
          <input type="text" class="form-control" id="search-text" aria-describedby="search-text" [(ngModel)]="searchText"
            placeholder="Search a station">
        </div>
      </div>
    </div>
    
    <input type="button" value="Download PDF" class="btn btn-success" (click)="savePDF('bikes')"><br>

    <!-- Filter buttons -->
    <label id="filter-buttons">Sort by: </label>
    <mat-radio-group aria-labelledby="filter-buttons-label" class="filterButtonsContainer" [(ngModel)]="bikeFilterChoice"
      (change)="setBikeFilter($event)">
      <mat-radio-button class="filterButton" *ngFor="let item of bikeFilterOptions" [value]="item">
        {{item}}
      </mat-radio-button>
    </mat-radio-group>

    <!-- Table to display Dublin bike data -->
    <div id="bikeTable">
      <table class="table">
        <thead>
          <tr>
            <th scope="col">Last Updated</th>
            <th scope="col">Station Name</th>
            <th scope="col">Available bikes</th>
            <th scope="col">Available stands</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let data of bikeData | searchFilter: searchText">
            <td scope="row">{{data.last_update | date: 'dd/MM/yyyy HH:mm'}}</td>
            <td scope="row">{{data.name}}</td>
            <td scope="row">{{data.available_bikes}}</td>
            <td scope="row">{{data.available_bike_stands}}</td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- AQI -->
    <p> Dublin Aqi </p>  
    <!-- Search bar -->
    <div role="main">
      <div>
        <div class="searchBar">
          <input type="text" class="form-control" id="search-aqi-text" aria-describedby="search-aqi-text"
            [(ngModel)]="aqiSearchText" placeholder="Search a station">
        </div>
      </div>
    </div>
    
    <input type="button" value="Download PDF" class="btn btn-success" (click)="savePDF('aqi')"><br>

    <!-- Filter buttons -->
    <label id="filter-buttons">Sort by: </label>
    <mat-radio-group aria-labelledby="filter-buttons-label" class="filterButtonsContainer" [(ngModel)]="aqiFilterChoice"
      (change)="setAqiFilter($event)">
      <mat-radio-button class="filterButton" *ngFor="let item of aqiOptions" [value]="item">
        {{item}}
      </mat-radio-button>
    </mat-radio-group>

    <!-- Table to display Aqi data -->
    <div id="aqiTable">
      <table id="aqiTable" class="table">
        <thead>
          <tr>
            <th scope="col">Last Updated</th>
            <th scope="col">Station Name</th>
            <th scope="col">Aqi Level</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let aqi of aqiData | searchFilter: aqiSearchText">
            <td scope="row">{{aqi.time.stime | date: 'dd/MM/yyyy HH:mm'}}</td>
            <td scope="row">{{aqi.station.name}}</td>
            <td scope="row">{{aqi.aqi}}</td>
          </tr>
        </tbody>
      </table>
    </div>
    
    <!-- PEDESTRIAN  -->
    <!-- Search bar -->
    <p> Pedestrian Data</p>
    <div role="main">
      <div>
        <div class="searchBar">
          <input type="text" class="form-control" id="search-aqi-text" aria-describedby="search-aqi-text"
            [(ngModel)]="pedestrianSearchText" placeholder="Search a street">
        </div>
      </div>
    </div>
    
    <input type="button" value="Download PDF" class="btn btn-success" (click)="savePDF('pedestrian')"><br>

    <!-- Filter buttons -->
    <label id="filter-buttons">Sort by: </label>
    <mat-radio-group aria-labelledby="filter-buttons-label" class="filterButtonsContainer"
      [(ngModel)]="pedestrianFilterChoice" (change)="setPedestrianFilter($event)">
      <mat-radio-button class="filterButton" *ngFor="let item of pedestrianOptions" [value]="item">
        {{item}}
      </mat-radio-button>
    </mat-radio-group>

    <!-- Table to display Pedestrian data -->
    <div id="pedestrianTable">
      <table class="table">
        <thead>
          <tr>
            <th scope="col">Location</th>
            <th scope="col">Count</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let pedestrian of pedestrianData | searchFilter: pedestrianSearchText">
            <td scope="row">{{pedestrian.street}}</td>
            <td scope="row">{{pedestrian.count}}</td>
          </tr>
        </tbody>
      </table>
    </div>
    
    <!-- DUBLIN BUS -->
    <!-- Search bar -->
    <p> Dublin Bus </p>
    <div role="main">
      <div>
        <div class="searchBar">
          <input type="text" class="form-control" id="search-text" aria-describedby="search-text" 
            [(ngModel)]="busSearchText" placeholder="Search a route">
        </div>
      </div>
    </div>
    
    <input type="button" value="Download PDF" class="btn btn-success" (click)="savePDF('bus')"><br>

    <!-- Filter buttons -->
    <label id="filter-buttons">Sort by: </label>
    <mat-radio-group
      aria-labelledby="filter-buttons-label"
      class="filterButtonsContainer"
      [(ngModel)]="busFilterChoice"
      (change)="setBusFilter($event)">
      <mat-radio-button class="filterButton" *ngFor="let item of busFilterOptions" [value]="item">
        {{item}}
      </mat-radio-button>
    </mat-radio-group>

    <!-- Table to display Dublin bus data -->
    <div id="busTable">
      <table class="table">
        <thead>
          <tr> 
            <th scope="col">Route</th>
            <th scope="col">Start Time</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let data of busData | searchFilter: busSearchText">
            <td scope="row">{{data.routeShort}}</td>
            <td scope="row">{{data.startTimestamp| date: 'dd/MM/yyyy HH:mm'}}</td>
          </tr>
        </tbody>
      </table>
    </div>

  </div>
  <div class="mapContainer">
    <!-- Map of data -->
    <h1> Map of Real-Time Data </h1>
    <section class="mapFilters">
      <h4>Filter data:</h4>
      <p><mat-checkbox [(ngModel)]="showBikeMarkers" (change)="setMapFilter()">Dublin Bikes</mat-checkbox></p>
      <p><mat-checkbox [(ngModel)]="showPedestrianMarkers" (change)="setMapFilter()">Pedestrians</mat-checkbox></p>
      <p><mat-checkbox [(ngModel)]="showBusMarkers" (change)="setMapFilter()">Dublin Bus</mat-checkbox></p>
      <p><mat-checkbox [(ngModel)]="showAqiMarkers" (change)="setMapFilter()">Aqi</mat-checkbox></p>
    </section>

    <div id="map-container">
      <div id="map"></div>
    </div>
  </div>
</div>
